{% extends 'base.html' %}
{% block content %}
<div class="d-flex justify-content-between align-items-center mb-3">
  <h4>График сотрудников</h4>
  <a href="{{ url_for('employees.index') }}" class="btn btn-outline-light">Список</a>
 </div>

<div class="row g-3">
  <div class="col-md-8">
    <div class="card bg-dark border-secondary">
      <div class="card-body">
        <div class="d-flex justify-content-between align-items-center mb-2">
          <form class="d-flex gap-2" method="get">
            <input type="number" class="form-control" name="y" value="{{year}}" style="max-width:120px">
            <input type="number" class="form-control" name="m" value="{{month}}" min="1" max="12" style="max-width:100px">
            <button class="btn btn-accent">Показать</button>
          </form>
        </div>
        <div class="table-responsive">
          <table class="table table-dark table-bordered align-middle text-center">
            <thead>
              <tr>
                <th>Сотрудник</th>
                {% for d in range(1,32) %}
                  <th style="width:34px">{{d}}</th>
                {% endfor %}
              </tr>
            </thead>
            <tbody>
              {% for e in employees %}
                <tr>
                  <th class="text-start">{{e.full_name}}</th>
                  {% for d in range(1,32) %}
                    {% set day_str = '%04d-%02d-%02d' % (year, month, d) %}
                    {% set day_shifts = [] %}
                    {% for s in shifts %}
                      {% if s.employee_id == e.id and s.day.strftime('%Y-%m-%d') == day_str %}
                        {% set _ = day_shifts.append(s) %}
                      {% endif %}
                    {% endfor %}
                    <td style="padding:2px">
                      {% for s in day_shifts %}
                        <div class="badge bg-secondary" title="{{s.start_time}}-{{s.end_time}}">{{s.start_time}}-{{s.end_time}}</div>
                        <form method="post" action="{{ url_for('employees.delete_shift', shift_id=s.id) }}">
                          <button class="btn btn-sm btn-outline-danger w-100">×</button>
                        </form>
                      {% endfor %}
                    </td>
                  {% endfor %}
                </tr>
              {% endfor %}
            </tbody>
          </table>
        </div>
      </div>
    </div>
  </div>
  <div class="col-md-4">
    <div class="card bg-dark border-secondary">
      <div class="card-body">
        <h6 class="mb-3">Добавить смену</h6>
        <form class="grid gap-2" method="post" action="{{ url_for('employees.add_shift') }}">
          <div class="mb-2">
            <label class="form-label">Сотрудник</label>
            <select class="form-select" name="employee_id">
              {% for e in employees %}<option value="{{e.id}}">{{e.full_name}} — {{e.position}}</option>{% endfor %}
            </select>
          </div>
          <div class="mb-2">
            <label class="form-label">Дата</label>
            <input class="form-control" type="date" name="day" value="{{'%04d-%02d-01' % (year, month)}}">
          </div>
          <div class="mb-2">
            <label class="form-label">Начало</label>
            <input class="form-control" type="time" name="start_time" value="09:00">
          </div>
          <div class="mb-3">
            <label class="form-label">Конец</label>
            <input class="form-control" type="time" name="end_time" value="18:00">
          </div>
          <button class="btn btn-accent w-100">Добавить</button>
        </form>
      </div>
    </div>
  </div>
 </div>
{% endblock %}




