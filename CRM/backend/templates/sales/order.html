{% extends 'base.html' %}
{% block content %}
<div class="row g-3">
  <div class="col-md-7">
    <div class="card bg-dark border-secondary">
      <div class="card-body">
        <h5>Заказ #{{order.id}} — сумма {{order.total}}</h5>
        <div class="table-responsive">
          <table class="table table-dark align-middle">
            <thead><tr><th>Блюдо</th><th class="text-end">Кол-во</th><th class="text-end">Цена</th><th class="text-end">Сумма</th><th></th></tr></thead>
            <tbody>
            {% for i in order.items %}
              <tr>
                <td>{{i.product_name}}</td>
                <td class="text-end">
                  <form class="d-inline" method="post" action="{{ url_for('sales.order_qty', order_id=order.id) }}">
                    <input type="hidden" name="item_id" value="{{i.id}}">
                    <input type="hidden" name="delta" value="-1">
                    <button class="btn btn-sm btn-outline-light">-</button>
                  </form>
                  <span class="mx-2">{{i.qty}}</span>
                  <form class="d-inline" method="post" action="{{ url_for('sales.order_qty', order_id=order.id) }}">
                    <input type="hidden" name="item_id" value="{{i.id}}">
                    <input type="hidden" name="delta" value="1">
                    <button class="btn btn-sm btn-outline-light">+</button>
                  </form>
                </td>
                <td class="text-end">{{i.unit_price}}</td>
                <td class="text-end">{{i.sum}}</td>
                <td class="text-end">
                  <form method="post" action="{{ url_for('sales.order_remove', order_id=order.id) }}" onsubmit="return confirm('Удалить позицию?')">
                    <input type="hidden" name="item_id" value="{{i.id}}">
                    <button class="btn btn-sm btn-outline-danger">Удалить</button>
                  </form>
                </td>
              </tr>
            {% endfor %}
            </tbody>
          </table>
        </div>
        <div class="d-flex gap-2">
          <form method="post" action="{{ url_for('sales.order_pay', order_id=order.id) }}">
            <input type="hidden" name="method" value="cash">
            <button class="btn btn-success">Оплатить (наличные)</button>
          </form>
          <form method="post" action="{{ url_for('sales.order_pay', order_id=order.id) }}">
            <input type="hidden" name="method" value="card">
            <button class="btn btn-primary">Оплатить (карта)</button>
          </form>
          <form method="post" action="{{ url_for('sales.order_pay', order_id=order.id) }}">
            <input type="hidden" name="method" value="online">
            <button class="btn btn-outline-light">Оплатить (QR/онлайн)</button>
          </form>
        </div>
      </div>
    </div>
  </div>
  <div class="col-md-5">
    <div class="card bg-dark border-secondary">
      <div class="card-body">
        <div class="mb-2">
          <strong>Категории</strong>
          <div class="d-flex flex-wrap gap-2 mt-2">
            {% for c in categories %}
              <a class="btn btn-sm btn-outline-light" href="#cat{{c.id}}">{{c.name}}</a>
            {% endfor %}
          </div>
        </div>
        {% for c in categories %}
          <h6 id="cat{{c.id}}" class="mt-3">{{c.name}}</h6>
          <div class="d-flex flex-wrap gap-2">
            {% for p in products %}
              {% if p.category_id==c.id %}
                <form method="post" action="{{ url_for('sales.order_add', order_id=order.id) }}">
                  <input type="hidden" name="product_id" value="{{p.id}}">
                  <input type="hidden" name="qty" value="1">
                  <button class="btn btn-outline-light">{{p.name}} — {{p.price}}</button>
                </form>
              {% endif %}
            {% endfor %}
          </div>
        {% endfor %}
      </div>
    </div>
  </div>
 </div>
{% endblock %}


